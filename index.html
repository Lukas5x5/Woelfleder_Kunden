<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WÃ¶lfleder AuÃŸendienst Manager</title>
    <link rel="stylesheet" href="styles-radical.css?v=3.3">
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <img src="logo.png" alt="WÃ¶lfleder Logo" class="login-logo" id="loginLogo">
                <h1>WÃ¶lfleder AuÃŸendienst Manager</h1>
                <p>Melden Sie sich an, um fortzufahren</p>
            </div>

            <div id="loginForm" class="auth-form">
                <h2>Anmelden</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Passwort</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">Angemeldet bleiben</label>
                    </div>
                    <button type="submit" class="btn btn-primary full-width">Anmelden</button>
                </form>
                <p class="auth-switch">
                    Noch kein Account? <a href="#" onclick="showRegisterForm()">Registrieren</a>
                </p>
            </div>

            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>Registrieren</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Passwort</label>
                        <input type="password" id="registerPassword" required minlength="6">
                        <small>Mindestens 6 Zeichen</small>
                    </div>
                    <div class="form-group">
                        <label>Passwort wiederholen</label>
                        <input type="password" id="registerPasswordConfirm" required>
                    </div>
                    <button type="submit" class="btn btn-primary full-width">Registrieren</button>
                </form>
                <p class="auth-switch">
                    Bereits registriert? <a href="#" onclick="showLoginForm()">Anmelden</a>
                </p>
            </div>

            <div id="authMessage" class="auth-message"></div>
        </div>
    </div>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="logo">
                    <img src="logo.png" alt="WÃ¶lfleder Logo" class="logo-img" id="logoImg">
                    <h1>WÃ¶lfleder - AuÃŸendienst Manager</h1>
                </div>
                <div class="header-actions">
                    <a href="http://localhost:3000" class="app-switcher-compact" title="Zur Tore & TÃ¼ren App" target="_blank">
                        ğŸšª
                    </a>
                    <div class="open-orders-dropdown">
                        <button class="btn btn-info" onclick="toggleOpenOrdersDropdown()" id="openOrdersBtn">
                            <span>ğŸ“‹</span><span>Offene AuftrÃ¤ge (<span id="openOrdersCount">0</span>)</span>
                        </button>
                        <div class="dropdown-content" id="openOrdersDropdown">
                            <div class="dropdown-header">Offene AuftrÃ¤ge</div>
                            <div id="openOrdersList" class="dropdown-list">
                                <!-- Open orders will be populated here -->
                            </div>
                        </div>
                    </div>
                    <span id="userEmail" class="user-email"></span>
                    <button class="btn btn-settings" onclick="showSettingsModal()">
                        <span>âš™ï¸</span><span>Einstellungen</span>
                    </button>
                    <button class="btn btn-primary" onclick="showNewCustomerModal()">
                        <span>â•</span><span>Neuer Kunde</span>
                    </button>
                    <button class="btn btn-logout" onclick="handleLogout()">
                        <span>â†©ï¸</span><span>Abmelden</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Filter & Search -->
        <div class="filter-section">
            <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” Kunde suchen...">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">Alle</button>
                <button class="filter-btn" data-filter="anfrage">Anfrage</button>
                <button class="filter-btn" data-filter="termin">Termin</button>
                <button class="filter-btn" data-filter="angebot">Angebot</button>
                <button class="filter-btn" data-filter="auftrag">Auftrag</button>
                <button class="filter-btn" data-filter="abgeschlossen">Abgeschlossen</button>
                <button class="filter-btn" data-filter="followup">ğŸ“… SpÃ¤ter kontaktieren</button>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-value" id="statTotal">0</div>
                <div class="stat-label">Gesamt Kunden</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“…</div>
                <div class="stat-value" id="statTermine">0</div>
                <div class="stat-label">Termine</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“‹</div>
                <div class="stat-value" id="statAnfragen">0</div>
                <div class="stat-label">Anfragen</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“¦</div>
                <div class="stat-value" id="statAuftraege">0</div>
                <div class="stat-label">AuftrÃ¤ge</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ””</div>
                <div class="stat-value" id="statFollowUp">0</div>
                <div class="stat-label">Wiedervorlage</div>
            </div>
        </div>

        <!-- Customers List -->
        <div class="customers-section">
            <h2>Kundenliste</h2>
            <div id="customersList" class="customers-list">
                <!-- Customers will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Modal: New/Edit Customer -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Neuer Kunde</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="customerForm" class="customer-form">
                <input type="hidden" id="customerId">

                <div class="form-group">
                    <label>Kundenname *</label>
                    <input type="text" id="customerName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="customerPhone">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="customerEmail">
                    </div>
                </div>

                <div class="form-group">
                    <label>Adresse</label>
                    <textarea id="customerAddress" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="customerNotes" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Fotos</label>
                    <input type="file" id="customerPhotos" accept="image/*" multiple>
                    <div id="photoPreview" class="photo-preview"></div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Customer Details -->
    <div id="detailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="detailsName"></h2>
                <button class="close-btn" onclick="closeDetailsModal()">&times;</button>
            </div>
            <div id="detailsContent" class="details-content">
                <!-- Details will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDetailsModal()">SchlieÃŸen</button>
                <button class="btn btn-primary" onclick="editFromDetails()">Bearbeiten</button>
            </div>
        </div>
    </div>

    <!-- Modal: Settings -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Einstellungen</h2>
                <button class="close-btn" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3>Eigene Auftragstypen</h3>
                    <div id="customTypesList" class="custom-types-list">
                        <!-- Custom types will be displayed here -->
                    </div>
                    <div class="add-type-form">
                        <input type="text" id="newTypeName" placeholder="Neuer Auftragstyp..." class="settings-input">
                        <button class="btn btn-primary btn-small" onclick="addCustomType()">â• HinzufÃ¼gen</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Daten sichern & wiederherstellen</h3>
                    <div class="backup-actions">
                        <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ Daten exportieren</button>
                        <label class="btn btn-secondary" style="margin: 0; cursor: pointer;">
                            ğŸ“¤ Daten importieren
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importDataFromFile(this.files[0])">
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Order (Auftrag) -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="orderModalTitle">Neuer Auftrag</h2>
                <button class="close-btn" onclick="closeOrderModal()">&times;</button>
            </div>
            <form id="orderForm" onsubmit="handleOrderSubmit(event)">
                <input type="hidden" id="orderId">
                <input type="hidden" id="orderCustomerId">

                <div class="form-row">
                    <div class="form-group">
                        <label for="orderNumber">Auftragsnummer</label>
                        <input type="text" id="orderNumber" placeholder="z.B. ORD-20250106-001">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="orderType">Auftragstyp *</label>
                        <select id="orderType" required>
                            <option value="standard">Standard</option>
                            <option value="ausmessen">Ausmessen Tore</option>
                            <option value="montage">Montage</option>
                            <option value="reparatur">Reparatur</option>
                            <option value="wartung">Wartung</option>
                            <option value="beratung">Beratung</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="orderStatus">Status *</label>
                        <select id="orderStatus" required>
                            <option value="anfrage">Anfrage</option>
                            <option value="termin">Termin vereinbart</option>
                            <option value="angebot">Angebot erstellt</option>
                            <option value="auftrag">Auftrag erteilt</option>
                            <option value="abgeschlossen">Abgeschlossen</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="orderSageRef">Sage Nummer</label>
                        <input type="text" id="orderSageRef" placeholder="z.B. 12345">
                    </div>
                    <div class="form-group">
                        <label for="orderAppointment">Termin</label>
                        <input type="datetime-local" id="orderAppointment">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="orderFollowUpDate">Wiedervorlage</label>
                        <input type="date" id="orderFollowUpDate">
                    </div>
                </div>

                <div class="form-group">
                    <label for="orderNotes">Notizen</label>
                    <textarea id="orderNotes" rows="4" placeholder="Auftragsnotizen..."></textarea>
                </div>

                <div class="form-group">
                    <label>Dokumente (Angebote, PDFs, etc.)</label>
                    <input type="file" id="orderDocuments" accept=".pdf,.doc,.docx,.xls,.xlsx" multiple>
                    <div id="orderDocumentPreview" class="document-preview"></div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeOrderModal()">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <script src="supabase-config.js"></script>
    <script src="supabase-auth.js"></script>
    <script src="order-service.js"></script>
    <script src="supabase-sync.js"></script>
    <script src="script.js"></script>
</body>
</html>
